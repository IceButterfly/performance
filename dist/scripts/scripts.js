"use strict";angular.module("yapp",["ui.router","ngAnimate","yapp.services","angular-datepicker","yapp.config","angucomplete","angular-md5","ngDialog"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.when("/dashboard","/dashboard/achievementManagement"),n.otherwise("/login"),e.state("base",{"abstract":!0,url:"",templateUrl:"views/base.html"}).state("login",{url:"/login",parent:"base",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("dashboard",{url:"/dashboard",parent:"base",templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).state("instanceList",{url:"/achievementManagement/:instanceId",parent:"dashboard",templateUrl:"views/dashboard/instanceList.html",controller:"instanceListCtrl"}).state("instanceList.achievementDetail",{url:"/achievementManagement/:instanceId/:taskId",parent:"dashboard",templateUrl:"views/dashboard/achievementDetail.html",controller:"achievementDetailCtrl"}).state("achievementManagement",{url:"/achievementManagement",parent:"dashboard",templateUrl:"views/dashboard/achievementManagement.html",controller:"achievementManagementCtrl"}).state("templateManagement",{url:"/templateManagement",parent:"dashboard",templateUrl:"views/dashboard/templateManagement.html",controller:"templateManagementCtrl"}).state("checkManagement",{url:"/checkManagement/:templateId",parent:"dashboard",templateUrl:"views/dashboard/checkManagement.html",controller:"checkManagementCtrl"}).state("checkManagement.checkDetailManagement",{url:"/checkManagement/:templateId/:instanceId",parent:"dashboard",templateUrl:"views/dashboard/checkDetailManagement.html",controller:"checkDetailManagementCtrl"}).state("checkManagement.checkDetailManagement.checkDetail",{url:"/checkManagement/:templateId/:instanceId/:taskId",parent:"dashboard",templateUrl:"views/dashboard/checkDetail.html",controller:"checkDetailCtrl"}).state("templateDetail",{url:"/templateManagement/:templateId",parent:"dashboard",templateUrl:"views/dashboard/templateDetail.html",controller:"templateDetailCtrl"}).state("gradeManagement",{url:"/gradeManagement",parent:"dashboard",templateUrl:"views/dashboard/gradeManagement.html",controller:"gradeManagementCtrl"}).state("gradeDetail",{url:"/gradeManagement/:gradeId",parent:"dashboard",templateUrl:"views/dashboard/gradeDetail.html",controller:"gradeDetailCtrl"}).state("report",{url:"/report",parent:"dashboard",templateUrl:"views/dashboard/report.html",controller:"reportCtrl"}).state("report.reportDetail",{url:"/report/:templateId",parent:"dashboard",templateUrl:"views/dashboard/reportDetail.html",controller:"reportDetailCtrl"})}]).run(["$rootScope","$location","Session",function(e,n,o){e.$on("$stateChangeStart",function(e,t){o.userId||n.path("/login")})}]),angular.module("yapp").controller("LoginCtrl",["$scope","$location","$http","ENV","md5","Session","ngDialog",function(e,n,o,t,s,r,a){function c(s){o.jsonp(t.domain+"gwlogin/user/login.do?callback=JSON_CALLBACK&account="+s.username+"&passwd="+s.password+"&roleRefer="+s.roleRefer).success(function(o){return o.body?(r.create(o.body.userId,o.body.email,o.body.organizationType,o.body.userOrganizationList[0].roleType,o.body.userOrganizationList[0].roleTypeText,o.newSessionId),e.clickToOpen("登陆成功！"),n.path("/dashboard"),void 0):(e.clickToOpen(o.errMsg),!1)}).error(function(e){alert("错误")})}r.destroy(),e.clickToOpen=function(e){a.open({template:'<div class="msgDiv"><span>'+e+"</span></div>",className:"ngdialog-theme-default",plain:!0})},e.login=function(e){var n={username:e.userName,password:s.createHash(e.passWord),roleRefer:9};c(n)},e.Login=function(e){var n={username:e.userName,password:s.createHash(e.passWord),roleRefer:8};c(n)}}]),angular.module("yapp").run(["$rootScope","ngDialog",function(e,n){e.clickToOpen=function(e){n.open({template:'<div class="msgDiv"><span>'+e+"</span></div>",className:"ngdialog-theme-default",plain:!0})},e.$on("childSeleteEmployees",function(n,o){e.$broadcast("parentSeleteEmployees",o)})}]).controller("DashboardCtrl",["$scope","$state","Session","$http","ENV",function(e,n,o,t,s){e.$state=n,e.Session=o,t.jsonp(s.domain+"performance/employee/query/findByUicId.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId+"&uicId="+o.userId).success(function(n){e.user=n.body}).error(function(){$rootScope.clickToOpen("错误")})}]).controller("gradeManagementCtrl",["$scope","Achievements","Grades","$rootScope",function(e,n,o,t){o.all().success(function(n){return n.success?void(n.body?e.Grades=n.body:e.Grades=[]):(t.clickToOpen(n.errMsg),!1)}).error(function(e){t.clickToOpen("错误")}),o.getSelf().success(function(n){return n.success?void(n.body?e.selfGrades=n.body:e.selfGrades=[]):(t.clickToOpen(n.errMsg),!1)}).error(function(e){t.clickToOpen("错误")})}]).controller("gradeDetailCtrl",["$scope","$stateParams","Grades","$rootScope","Session","$http","ENV","$state",function(e,n,o,t,s,r,a,c){o.get(n.gradeId).success(function(n){return n.success?void(n.body?(e.grade=n.body,e.Customeres=n.body.customerVOList):e.grade=[]):(t.clickToOpen(n.errMsg),!1)}).error(function(e){t.clickToOpen("错误")}),o.find(n.gradeId).success(function(n){return n.success?(e.score=n.body,n.body.conceptScoreValue||(e.score.score=1,e.score.conceptScore=1),n.body.selfConceptScoreValue?e.score=n.body:(e.score.selfConceptScoreValue="还未自评",e.score.selfScoreValue=""),void 0):(t.clickToOpen(n.errMsg),!1)}).error(function(e){t.clickToOpen("错误")}),e.submitForm=function(e){return 1!=e.conceptScore&&1!=e.score||e.reason?void r.jsonp(a.domain+"performance/score/write/updateScore.do?callback=JSON_CALLBACK&sessionId="+s.newSessionId+"&score="+e.score+"&conceptScore="+e.conceptScore+"&reason="+e.reason+"&scoreId="+e.id).success(function(e){return e.success?(t.clickToOpen("评价成功!"),void c.go("gradeManagement")):(t.clickToOpen(e.errMsg),!1)}).error(function(e){t.clickToOpen(e.errMsg)}):(t.clickToOpen("填写3.75或A时,请填写理由"),!1)},e.goBack=function(){history.back(-1)}}]).controller("findAllEmployeesCtrl",["$scope","Session","$http","ENV",function(e,n,o,t){o.jsonp(t.domain+"performance/employee/query/findAllCustomer.do?callback=JSON_CALLBACK&sessionId="+n.newSessionId+"&employeeName=").success(function(n){e.Employees=n.body}).error(function(e){$rootScope.clickToOpen(e.errMsg)}),e.seleteEmployee=function(n){e.$emit("childSeleteEmployees",n)}}]).controller("achievementDetailCtrl",["$scope","Achievements","$stateParams","Session","$http","ENV","$state","$rootScope","ngDialog",function(e,n,o,t,s,r,a,c,i){e.Employees=[],o.taskId?s.jsonp(r.domain+"performance/task/query/findById.do?callback=JSON_CALLBACK&sessionId="+t.newSessionId+"&taskId="+o.taskId).success(function(n){return n.success?(e.isToChange=!0,e.achievement=n.body,e.Employees=n.body.customerVOList,void 0):(c.clickToOpen(n.errMsg),!1)}):e.isToChange=!1,e.$on("parentSeleteEmployees",function(n,o){for(var t=0;t<e.Employees.length;t++)if(e.Employees[t].id===o.id)return;e.Employees.push(o)}),e.changeForm=function(n){var i="";n.taskId=o.taskId;for(var l in e.Employees)i+=e.Employees[l].id+",";var d=encodeURI(n.description),p=encodeURI(n.basicStandard),m=encodeURI(n.beyondStandard);s.jsonp(r.domain+"performance/task/write/updateTask.do?callback=JSON_CALLBACK&sessionId="+t.newSessionId+"&basicStandard="+p+"&beyondStandard="+m+"&description="+d+"&id="+n.id+"&percentage="+n.percentage+"&pfmcInstanceId="+n.pfmcInstanceId+"&title="+n.title+"&taskId="+n.taskId+"&customerIdList="+i).success(function(e){return e.success?(c.clickToOpen("修改成功！"),void a.go("instanceList",{instanceId:o.instanceId})):(c.clickToOpen(e.errMsg),!1)})},e.submitForm=function(n){var i="";n.pfinId=o.instanceId;for(var l in e.Employees)i+=e.Employees[l].id+",";var d=encodeURI(n.description),p=encodeURI(n.basicStandard),m=encodeURI(n.beyondStandard);s.jsonp(r.domain+"performance/task/write/addTask.do?callback=JSON_CALLBACK&sessionId="+t.newSessionId+"&basicStandard="+p+"&beyondStandard="+m+"&description="+d+"&id="+n.id+"&percentage="+n.percentage+"&pfmcInstanceId="+n.pfmcInstanceId+"&title="+n.title+"&pfinId="+n.pfinId+"&customerIdList="+i).success(function(e){return e.success?(c.clickToOpen("提交成功！"),void a.go("instanceList",{instanceId:o.instanceId})):(c.clickToOpen(e.errMsg),!1)})},e.findAllEmployees=function(){i.open({template:"views/findAllEmployees.html",className:"ngdialog-theme-default",controller:"findAllEmployeesCtrl"})},e.deleteEmployee=function(n){e.Employees.splice(e.Employees.indexOf(n),1)},e.goBack=function(){history.back(-1)}}]).controller("instanceListCtrl",["$scope","$stateParams","Achievements","$rootScope","$http","ENV","Session","$state",function(e,n,o,t,s,r,a,c){e.instanceId=n.instanceId,o.all(e.instanceId).success(function(n){if(!n.success)return t.clickToOpen(n.errMsg),!1;if(e.instance=n.body,n.body.taskScoreList){e.Achievements=n.body.taskScoreList;for(var o in e.Achievements)e.Achievements[o].status=e.instance.status}else e.Achievements=[]}).error(function(e){t.clickToOpen("错误")}),e["new"]=function(){var n=e.Achievements.length,o={id:n+1,title:"绩效"+(n+1),status:0};e.Achievements.push(o)},e.goBack=function(){c.go("achievementManagement")},e["delete"]=function(e){s.jsonp(r.domain+"performance/task/write/deleteTaskById.do?callback=JSON_CALLBACK&sessionId="+a.newSessionId+"&taskId="+e).success(function(e){return e.success?(t.clickToOpen("删除成功！"),void c.reload()):(t.clickToOpen(e.errMsg),!1)})}}]).controller("achievementManagementCtrl",["$scope","Templates","$rootScope","$http","ENV","Session","$state",function(e,n,o,t,s,r,a){e.Instance=[],n.getInstance().success(function(n){return n.success?void(n.body?e.Instances=n.body:o.clickToOpen("未开始任何绩效!")):(o.clickToOpen(n.errMsg),!1)}).error(function(e){o.clickToOpen("错误")}),e.submitInstance=function(e){t.jsonp(s.domain+"performance/performanceInstance/write/submitInstance.do?callback=JSON_CALLBACK&sessionId="+r.newSessionId+"&pfinId="+e).success(function(e){return e.success?(o.clickToOpen("提交成功！"),void a.reload()):(o.clickToOpen(e.errMsg),!1)})}}]).controller("templateManagementCtrl",["$scope","$stateParams","Templates","$rootScope","$state",function(e,n,o,t,s){o.all().success(function(n){return n.success?void(n.body?e.Templates=n.body:e.Templates=[]):(t.clickToOpen(n.errMsg),!1)}).error(function(e){t.clickToOpen("错误")}),e["new"]=function(){var n=e.Templates.length,o={id:n+1,name:"模板"+(n+1),status:0};e.Templates.push(o)},e["delete"]=function(e){o["delete"](e).success(function(e){return e.success?(t.clickToOpen("成功"),void s.reload()):(t.clickToOpen(e.errMsg),!1)}).error(function(e){t.clickToOpen("错误")})},e.create=function(e){o.create(e).success(function(e){return e.success?(t.clickToOpen("成功"),void s.reload()):(t.clickToOpen(e.errMsg),!1)}).error(function(e){t.clickToOpen("错误")})},e.startGrade=function(e){o.startGrade(e).success(function(e){return e.success?(t.clickToOpen("评分已开始!"),void s.reload()):(t.clickToOpen(e.errMsg),!1)}).error(function(e){t.clickToOpen("错误")})},e.overGrade=function(e){o.overGrade(e).success(function(e){return e.success?(t.clickToOpen("成功"),void s.reload()):(t.clickToOpen(e.errMsg),!1)}).error(function(e){t.clickToOpen("错误")})},e.endPerformance=function(e){o.endPerformance(e).success(function(e){return e.success?(t.clickToOpen("成功"),void s.reload()):(t.clickToOpen(e.errMsg),!1)}).error(function(e){t.clickToOpen("错误")})}}]).controller("checkDetailCtrl",["$scope","Achievements","$stateParams","Session","$http","ENV","$rootScope","$state",function(e,n,o,t,s,r,a,c){s.jsonp(r.domain+"performance/task/query/findById.do?callback=JSON_CALLBACK&sessionId="+t.newSessionId+"&taskId="+o.taskId).success(function(n){return n.success?(e.achievement=n.body,void(e.Customeres=n.body.customerVOList)):(a.clickToOpen(n.errMsg),!1)}),e.goBack=function(){history.back(-1)}}]).controller("checkDetailManagementCtrl",["$http","Session","$scope","$stateParams","$rootScope","ENV",function(e,n,o,t,s,r){o.templateId=t.templateId,o.instanceId=t.instanceId,e.jsonp(r.domain+"performance/performanceInstance/query/findById.do?callback=JSON_CALLBACK&sessionId="+n.newSessionId+"&pfinId="+t.instanceId).success(function(e){return e.success?void(o.Achievements=e.body.taskScoreList):(s.clickToOpen(e.errMsg),!1)}).error(function(e){s.clickToOpen("错误")}),o.goBack=function(){history.back(-1)}}]).controller("checkManagementCtrl",["$http","Session","$scope","$stateParams","$rootScope","ENV","$state",function(e,n,o,t,s,r,a){o.templateId=t.templateId,e.jsonp(r.domain+"performance/performanceInstance/query/findByPerformanceTemplateId.do?callback=JSON_CALLBACK&sessionId="+n.newSessionId+"&pfmcId="+t.templateId).success(function(e){return e.success?void(o.Instances=e.body):(s.clickToOpen(e.errMsg),!1)}).error(function(e){s.clickToOpen("错误")}),o.passAudit=function(o){e.jsonp(r.domain+"performance/performanceInstance/write/passAudit.do?callback=JSON_CALLBACK&sessionId="+n.newSessionId+"&pfinId="+o).success(function(e){return e.success?(s.clickToOpen("审核通过成功!"),void a.reload()):(s.clickToOpen(e.errMsg),!1)}).error(function(e){s.clickToOpen("错误")})},o.notPassAudit=function(o){e.jsonp(r.domain+"performance/performanceInstance/write/notPassAudit.do?callback=JSON_CALLBACK&sessionId="+n.newSessionId+"&pfinId="+o).success(function(e){return e.success?(s.clickToOpen("驳回成功!"),void a.reload()):(s.clickToOpen(e.errMsg),!1)}).error(function(e){s.clickToOpen("错误")})}}]).controller("templateDetailCtrl",["$scope","Templates","$stateParams","$http","ENV","Session","$rootScope","$location",function(e,n,o,t,s,r,a,c){var i="";e.submitForm=function(n){var o={departmentId:e.template.departmentId,startTime:Date.parse(new Date(e.template.startTime)),endTime:Date.parse(new Date(e.template.endTime)),name:e.template.name,ownerUid:e.template.ownerUid.originalObject.id,statisticsUid:e.template.statisticsUid.originalObject.id};for(var l in o)i+="&"+l+"="+o[l];t.jsonp(s.domain+"performance/performanceTemplate/write/addPerformanceTemplate.do?callback=JSON_CALLBACK&sessionId="+r.newSessionId+i).success(function(e){return e.success?(a.clickToOpen("发布成功！"),void c.path("/dashboard/templateManagement")):(a.clickToOpen(e.errMsg),!1)}).error(function(e){a.clickToOpen("错误")})},e.options={format:"yyyy-mm-dd",monthsFull:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],weekdaysShort:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],today:"今天",clear:"清除",onClose:function(e){}},t.jsonp(s.domain+"performance/department/query/findAll.do?callback=JSON_CALLBACK&sessionId="+r.newSessionId).success(function(n){e.Departments=n.body}).error(function(){alert("错误")}),t.jsonp(s.domain+"performance/employee/query/findByCondition.do?callback=JSON_CALLBACK&sessionId="+r.newSessionId+"&employeeName=").success(function(n){e.Employees=n.body}).error(function(){alert("错误")})}]).controller("reportCtrl",["$scope","Templates","$rootScope",function(e,n,o){n.all().success(function(n){return n.success?void(e.Templates=n.body):(o.clickToOpen(n.errMsg),!1)}).error(function(e){o.clickToOpen("错误")})}]).controller("reportDetailCtrl",["$scope","$stateParams","$http","ENV","Session","$rootScope","$state",function(e,n,o,t,s,r,a){o.jsonp(t.domain+"performance/reportForms/query/findByPerformanceTemplateId.do?callback=JSON_CALLBACK&sessionId="+s.newSessionId+"&pfmcId="+n.templateId).success(function(n){if(!n.success)return r.clickToOpen(n.errMsg),!1;e.reportForms=n.body;for(var o in e.reportForms)e.reportForms[o].score=e.reportForms[o].score.toString(),e.reportForms[o].conceptScore=e.reportForms[o].conceptScore.toString()}).error(function(e){r.clickToOpen("错误")}),e.scoreOptions=[{name:"3.75",value:"1"},{name:"3.5",value:"2"},{name:"3.25",value:"3"}],e.conceptScoreOptions=[{name:"A",value:"1"},{name:"B",value:"2"},{name:"C",value:"3"}],e.update=function(e){o.jsonp(t.domain+"performance/performanceInstance/write/updatePerformanceInstance.do?callback=JSON_CALLBACK&sessionId="+s.newSessionId+"&score="+e.score+"&conceptScore="+e.conceptScore+"&pfinId="+e.pfmcInstanceId).success(function(e){return e.success?(r.clickToOpen("评分成功!"),void a.reload()):(r.clickToOpen(e.errMsg),!1)}).error(function(e){r.clickToOpen("错误")})}}]),angular.module("yapp.services",[]).factory("Achievements",["$http","ENV","Session",function(e,n,o){return{all:function(t){return e.jsonp(n.domain+"performance/performanceInstance/query/findById.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId+"&pfinId="+t)}}}]).factory("Templates",["$http","ENV","Session",function(e,n,o){return{getInstance:function(t){return e.jsonp(n.domain+"performance/performanceInstance/query/findAllPfin.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId)},Simpleall:function(){return e.jsonp(n.domain+"performance/performanceTemplate/query/findSimplePerformanceTemplateList.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId)},all:function(){return e.jsonp(n.domain+"performance/performanceTemplate/query/findPerformanceTemplateList.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId)},"delete":function(t){return e.jsonp(n.domain+"performance/performanceTemplate/write/deletePerformanceTemplateById.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId+"&pfmcId="+t)},create:function(t){return e.jsonp(n.domain+"performance/performanceTemplate/write/createInstance.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId+"&pfmcId="+t)},startGrade:function(t){return e.jsonp(n.domain+"performance/performanceTemplate/write/startGrade.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId+"&pfmcId="+t)},overGrade:function(t){return e.jsonp(n.domain+"performance/performanceTemplate/write/overGrade.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId+"&pfmcId="+t)},endPerformance:function(t){return e.jsonp(n.domain+"performance/performanceTemplate/write/endPerformance.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId+"&pfmcId="+t)}}}]).factory("Grades",["$http","ENV","Session",function(e,n,o){return{getSelf:function(){return e.jsonp(n.domain+"performance/task/query/findSelfList.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId)},all:function(){return e.jsonp(n.domain+"performance/task/query/findList.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId)},get:function(t){return e.jsonp(n.domain+"/performance/task/query/findById.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId+"&taskId="+t)},find:function(t){return e.jsonp(n.domain+"performance/score/query/findByTaskIdAndCustomerId.do?callback=JSON_CALLBACK&sessionId="+o.newSessionId+"&taskId="+t)}}}]).service("Session",function(){return this.create=function(e,n,o,t,s,r){this.userId=e,this.email=n,this.organizationType=o,this.roleType=t,this.roleTypeText=s,this.newSessionId=r},this.destroy=function(){this.userId=null,this.email=null,this.organizationType=null,this.email=null,this.organizationType=null,this.newSessionId=null},this}),angular.module("yapp.config",[]).constant("ENV",{version:"1",name:"绩效系统",debug:!1,domain:"http://192.168.158.204:8080/"});